"use strict";
const express = require('express');
const demoApi = require('./api');
const base_1 = require('./api/base');
// initialize our express app
var app = express();
// initialize our classes
const controllers = demoApi.initializeControllers();
demoApi.registerRouter(controllers);
// register the security handler
base_1.DemoApi_V1.SecurityMiddlewares.myCustomSec = (req, res, next) => {
    if (req.query['token'] != 'safe') {
        throw new base_1.HttpError.Unauthorized('invalid token');
    }
    next();
};
base_1.DemoApi_V1.httpErrorHandler = (error, req, res, next) => {
    res.status(error.status).send(`<h1>${error.message || error.constructor.name}</h1>`);
};
// register our api middleware on express
app.use(demoApi.getMiddleware());
app.use(function (error, req, res, next) {
    res.status(error.code || 400).send(`<h1>${error.message || error.constructor.name}</h1><hr/><pre>` + JSON.stringify(error, null, 4) + '</pre>');
});
// run!
app.listen(3001, () => console.log('Listening on port 3001'));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxNQUFZLE9BQU8sV0FBTSxTQUFTLENBQUMsQ0FBQTtBQUNuQyxNQUFZLE9BQU8sV0FBTSxPQUFPLENBQUMsQ0FBQTtBQUNqQyx1QkFBc0MsWUFBWSxDQUFDLENBQUE7QUFFbkQsNkJBQTZCO0FBQzdCLElBQUksR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0FBRXBCLHlCQUF5QjtBQUN6QixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMscUJBQXFCLEVBQUUsQ0FBQztBQUNwRCxPQUFPLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBRXBDLGdDQUFnQztBQUVoQyxpQkFBVSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtJQUN4RCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFBLENBQUM7UUFDN0IsTUFBTSxJQUFJLGdCQUFTLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFDRCxJQUFJLEVBQUUsQ0FBQztBQUNYLENBQUMsQ0FBQTtBQUVELGlCQUFVLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJO0lBQ2hELEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLEtBQUssQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDO0FBQ3pGLENBQUMsQ0FBQTtBQUVELHlDQUF5QztBQUN6QyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO0FBRWpDLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBUyxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJO0lBQ2xDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxLQUFLLENBQUMsT0FBTyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUM7QUFDcEosQ0FBUSxDQUFDLENBQUM7QUFFVixPQUFPO0FBQ1AsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBkZW1vQXBpIGZyb20gJy4vYXBpJztcbmltcG9ydCB7IERlbW9BcGlfVjEsIEh0dHBFcnJvciB9IGZyb20gJy4vYXBpL2Jhc2UnO1xuXG4vLyBpbml0aWFsaXplIG91ciBleHByZXNzIGFwcFxudmFyIGFwcCA9IGV4cHJlc3MoKTtcblxuLy8gaW5pdGlhbGl6ZSBvdXIgY2xhc3Nlc1xuY29uc3QgY29udHJvbGxlcnMgPSBkZW1vQXBpLmluaXRpYWxpemVDb250cm9sbGVycygpO1xuZGVtb0FwaS5yZWdpc3RlclJvdXRlcihjb250cm9sbGVycyk7XG5cbi8vIHJlZ2lzdGVyIHRoZSBzZWN1cml0eSBoYW5kbGVyXG5cbkRlbW9BcGlfVjEuU2VjdXJpdHlNaWRkbGV3YXJlcy5teUN1c3RvbVNlYyA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGlmKHJlcS5xdWVyeVsndG9rZW4nXSAhPSAnc2FmZScpe1xuICAgICAgICB0aHJvdyBuZXcgSHR0cEVycm9yLlVuYXV0aG9yaXplZCgnaW52YWxpZCB0b2tlbicpO1xuICAgIH1cbiAgICBuZXh0KCk7XG59XG5cbkRlbW9BcGlfVjEuaHR0cEVycm9ySGFuZGxlciA9IChlcnJvciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgICByZXMuc3RhdHVzKGVycm9yLnN0YXR1cykuc2VuZChgPGgxPiR7ZXJyb3IubWVzc2FnZSB8fCBlcnJvci5jb25zdHJ1Y3Rvci5uYW1lfTwvaDE+YCk7XG59XG5cbi8vIHJlZ2lzdGVyIG91ciBhcGkgbWlkZGxld2FyZSBvbiBleHByZXNzXG5hcHAudXNlKGRlbW9BcGkuZ2V0TWlkZGxld2FyZSgpKTtcblxuYXBwLnVzZShmdW5jdGlvbihlcnJvciwgcmVxLCByZXMsIG5leHQpIHtcbiAgICByZXMuc3RhdHVzKGVycm9yLmNvZGUgfHwgNDAwKS5zZW5kKGA8aDE+JHtlcnJvci5tZXNzYWdlIHx8IGVycm9yLmNvbnN0cnVjdG9yLm5hbWV9PC9oMT48aHIvPjxwcmU+YCArIEpTT04uc3RyaW5naWZ5KGVycm9yLCBudWxsLCA0KSArICc8L3ByZT4nKTtcbn0gYXMgYW55KTtcblxuLy8gcnVuIVxuYXBwLmxpc3RlbigzMDAxLCAoKSA9PiBjb25zb2xlLmxvZygnTGlzdGVuaW5nIG9uIHBvcnQgMzAwMScpKTsiXX0=