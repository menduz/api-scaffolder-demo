"use strict";
const express = require('express');
const demoApi = require('./api');
const base_1 = require('./api/base');
// initialize our express app
var app = express();
// initialize our classes
const controllers = demoApi.initializeControllers();
demoApi.registerRouter(controllers);
// register the security handler
base_1.DemoApiV1.SecurityMiddlewares.myCustomSec = (req, res, next) => {
    if (req.query['token'] != 'safe') {
        throw new base_1.DemoApiV1.HttpError.Unauthorized('invalid token');
    }
    next();
};
/*
// register the error handler
DemoApiV1.httpErrorHandler = (err, req, res, next) => {
    res.send('EROOOOOOR! <b>' + err.status + '</b>');
    next(err);
}*/
// register our api middleware on express
app.use(demoApi.getMiddleware());
// run!
app.listen(3001, () => console.log('Listening on port 3001'));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxNQUFZLE9BQU8sV0FBTSxTQUFTLENBQUMsQ0FBQTtBQUNuQyxNQUFZLE9BQU8sV0FBTSxPQUFPLENBQUMsQ0FBQTtBQUNqQyx1QkFBMEIsWUFBWSxDQUFDLENBQUE7QUFFdkMsNkJBQTZCO0FBQzdCLElBQUksR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0FBRXBCLHlCQUF5QjtBQUN6QixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMscUJBQXFCLEVBQUUsQ0FBQztBQUNwRCxPQUFPLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBRXBDLGdDQUFnQztBQUNoQyxnQkFBUyxDQUFDLG1CQUFtQixDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtJQUN2RCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFBLENBQUM7UUFDN0IsTUFBTSxJQUFJLGdCQUFTLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBQ0QsSUFBSSxFQUFFLENBQUM7QUFDWCxDQUFDLENBQUE7QUFDRDs7Ozs7R0FLRztBQUVILHlDQUF5QztBQUN6QyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO0FBSWpDLE9BQU87QUFDUCxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCAqIGFzIGRlbW9BcGkgZnJvbSAnLi9hcGknO1xuaW1wb3J0IHsgRGVtb0FwaVYxIH0gZnJvbSAnLi9hcGkvYmFzZSc7XG5cbi8vIGluaXRpYWxpemUgb3VyIGV4cHJlc3MgYXBwXG52YXIgYXBwID0gZXhwcmVzcygpO1xuXG4vLyBpbml0aWFsaXplIG91ciBjbGFzc2VzXG5jb25zdCBjb250cm9sbGVycyA9IGRlbW9BcGkuaW5pdGlhbGl6ZUNvbnRyb2xsZXJzKCk7XG5kZW1vQXBpLnJlZ2lzdGVyUm91dGVyKGNvbnRyb2xsZXJzKTtcblxuLy8gcmVnaXN0ZXIgdGhlIHNlY3VyaXR5IGhhbmRsZXJcbkRlbW9BcGlWMS5TZWN1cml0eU1pZGRsZXdhcmVzLm15Q3VzdG9tU2VjID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgaWYocmVxLnF1ZXJ5Wyd0b2tlbiddICE9ICdzYWZlJyl7XG4gICAgICAgIHRocm93IG5ldyBEZW1vQXBpVjEuSHR0cEVycm9yLlVuYXV0aG9yaXplZCgnaW52YWxpZCB0b2tlbicpO1xuICAgIH1cbiAgICBuZXh0KCk7XG59XG4vKlxuLy8gcmVnaXN0ZXIgdGhlIGVycm9yIGhhbmRsZXJcbkRlbW9BcGlWMS5odHRwRXJyb3JIYW5kbGVyID0gKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgICByZXMuc2VuZCgnRVJPT09PT09SISA8Yj4nICsgZXJyLnN0YXR1cyArICc8L2I+Jyk7XG4gICAgbmV4dChlcnIpO1xufSovXG5cbi8vIHJlZ2lzdGVyIG91ciBhcGkgbWlkZGxld2FyZSBvbiBleHByZXNzXG5hcHAudXNlKGRlbW9BcGkuZ2V0TWlkZGxld2FyZSgpKTtcblxuXG5cbi8vIHJ1biFcbmFwcC5saXN0ZW4oMzAwMSwgKCkgPT4gY29uc29sZS5sb2coJ0xpc3RlbmluZyBvbiBwb3J0IDMwMDEnKSk7Il19