// THIS IS AN AUTOGENERATED FILE, ANY CHANGES WILL BE LOST. DO NO EDIT THIS FILE
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator.throw(value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments)).next());
    });
};
var ospreyRouter = require('osprey-router');
var bodyParser = require('body-parser');
/// DemoApi
var DemoApiV1;
(function (DemoApiV1) {
    var theRouter = ospreyRouter();
    const contextSymbol = Symbol('request-context');
    class BaseControllerResponse {
        constructor(data) {
            this.data = data;
            this.status = 200;
        }
    }
    DemoApiV1.BaseControllerResponse = BaseControllerResponse;
    function getMiddleware() {
        return theRouter;
    }
    DemoApiV1.getMiddleware = getMiddleware;
    function getContext(expressRequest) {
        return (expressRequest[contextSymbol] = (expressRequest[contextSymbol] || {}));
    }
    DemoApiV1.getContext = getContext;
    var SecurityMiddlewares;
    (function (SecurityMiddlewares) {
        SecurityMiddlewares.securitySettings = {};
        function no_authenticate(req, res, next) {
            next();
        }
        SecurityMiddlewares.no_authenticate = no_authenticate;
    })(SecurityMiddlewares = DemoApiV1.SecurityMiddlewares || (DemoApiV1.SecurityMiddlewares = {}));
    var SecurityMiddlewaresInvokers;
    (function (SecurityMiddlewaresInvokers) {
        SecurityMiddlewaresInvokers.no_authenticate = (req, res, next) => SecurityMiddlewares.no_authenticate(req, res, next);
    })(SecurityMiddlewaresInvokers || (SecurityMiddlewaresInvokers = {}));
    /**
     * @param {Array} list of middleware to combine
     */
    function concatMiddlewares(list) {
        return function (req, res, next) {
            function iter(i) {
                var mid = list[i];
                if (!mid)
                    return next();
                mid(req, res, function (err) {
                    if (err)
                        return next(err);
                    iter(i + 1);
                });
            }
            iter(0);
        };
    }
    class BaseController {
        /** Register this resource in the specified osprey-router. */
        registerRouter(ospreyRouter) {
            if (!ospreyRouter)
                ospreyRouter = theRouter;
            for (let verb in this.methods) {
                let method = this.methods[verb];
                ospreyRouter[verb](this.baseUri, this.baseUriParameters, this.getRequestHandler(verb, method));
            }
        }
        generateQueryStringParams(params) {
            var queryString = {};
            for (let i in params) {
                let parameter = params[i];
                queryString[i] = parameter.name in this.currentContext.request.query ? this.currentContext.request.query[parameter.name] : parameter.default;
                if (!(parameter.name in this.currentContext.request.query) && parameter.required && !('default' in parameter)) {
                    throw new Error("Missing query string parameter " + parameter.name);
                }
                if (parameter.type == "number" || parameter.type == "integer") {
                    if (typeof queryString[i] != "undefined" && typeof queryString[i] != "number") {
                        if (parameter.type == "number")
                            queryString[i] = parseFloat(queryString[i]);
                        else
                            queryString[i] = parseInt(queryString[i]);
                        if (isNaN(queryString[i])) {
                            if (parameter.required) {
                                throw new Error("Invalid query string parameter " + parameter.name + ": " + JSON.stringify(this.currentContext.request.query[parameter.name]));
                            }
                            else {
                                queryString[i] = parameter.default || null;
                            }
                        }
                    }
                }
            }
            return queryString;
        }
        generateHeaderParams(headers) {
            var ret = {};
            for (let i in headers) {
                let header = headers[i];
                ret[i] = this.currentContext.request.get(header.name) || header.default;
            }
            return ret;
        }
        getRequestHandler(name, method) {
            let middleware = (req, res, next) => {
                this.setUpCurrentContext(req, res);
                let args = [];
                if (method.body) {
                    if (typeof method.body == "function") {
                        method.body(req, res, next);
                    }
                    else {
                        bodyParser.json()(req, res, next);
                    }
                    args.push(this.currentContext.request.body);
                }
                if (method.queryString) {
                    args.push(this.generateQueryStringParams(method.queryString));
                }
                if (method.headers) {
                    args.push(this.generateHeaderParams(method.headers));
                }
                try {
                    this[name].apply(this, args).then((r) => {
                        if (r && r instanceof BaseControllerResponse) {
                            res.status(r.status);
                            if (r.mime) {
                                res.set('Content-Type', r.mime);
                            }
                            if (r.mime == 'application/json') {
                                res.json(r.data);
                            }
                            else {
                                res.send(r.data);
                            }
                            return;
                        }
                        else if (!r) {
                            next();
                            return;
                        }
                        if (r && r instanceof Error)
                            next(r);
                        else
                            next(new Error('Unknown method result ' + name.toUpperCase() + ' ' + this.baseUri));
                    }).catch(next);
                }
                catch (e) {
                    next(e);
                }
            };
            if (method.securedBy.length) {
                return concatMiddlewares(method
                    .securedBy
                    .map(securitySchema => SecurityMiddlewaresInvokers[securitySchema])
                    .concat(middleware));
            }
            else {
                return middleware;
            }
        }
        setUpCurrentContext(req, res, ctx) {
            this.currentContext = {
                request: req,
                response: res,
                context: getContext(req)
            };
            this.fillUriParameters(this.currentContext.request.params);
        }
        fillUriParameters(params) {
            if (!params)
                return;
            for (var param in this.baseUriParameters) {
                if (param in params) {
                    this.uriParameters[param] = params[param];
                }
            }
        }
    }
    DemoApiV1.BaseController = BaseController;
    /**
     * /me
     *
     */
    var Me;
    (function (Me) {
        class GetResult200 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 200;
                this.mime = "application/json";
            }
        }
        Me.GetResult200 = GetResult200;
        /**
        * /me abstract handler.
        */
        class AbstractHandler extends BaseController {
            constructor(...args) {
                super(...args);
                this.baseUri = "/me";
                this.baseUriParameters = {};
                this.methods = {
                    "get": {
                        "body": false,
                        "queryString": null,
                        "headers": null,
                        "securedBy": []
                    }
                };
                this.uriParameters = {};
            }
        }
        Me.AbstractHandler = AbstractHandler;
    })(Me = DemoApiV1.Me || (DemoApiV1.Me = {}));
    /**
     * /users/{userId}
     *
     */
    var UserById;
    (function (UserById) {
        class GetResult200 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 200;
                this.mime = "application/json";
            }
        }
        UserById.GetResult200 = GetResult200;
        /**
        * /users/{userId} abstract handler.
        */
        class AbstractHandler extends BaseController {
            constructor(...args) {
                super(...args);
                this.baseUri = "/users/{userId}";
                this.baseUriParameters = {
                    "userId": {
                        "displayName": "userId",
                        "type": "string",
                        "required": true,
                        "description": ""
                    }
                };
                this.methods = {
                    "get": {
                        "body": false,
                        "queryString": {
                            "filter": {
                                "displayName": "filter",
                                "type": "string",
                                "description": "",
                                "name": "filter"
                            }
                        },
                        "headers": null,
                        "securedBy": []
                    }
                };
                this.uriParameters = {
                    userId: void (0)
                };
            }
        }
        UserById.AbstractHandler = AbstractHandler;
    })(UserById = DemoApiV1.UserById || (DemoApiV1.UserById = {}));
    /**
     * /status
     *
     */
    var Status;
    (function (Status) {
        /* Response get status 200 do not describe any schema nor MIME */
        class GetResult200 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 200;
            }
        }
        Status.GetResult200 = GetResult200;
        /* Response get status 202 do not describe any schema nor MIME */
        class GetResult202 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 202;
            }
        }
        Status.GetResult202 = GetResult202;
        /* Response get status 401 do not describe any schema nor MIME */
        class GetResult401 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 401;
            }
        }
        Status.GetResult401 = GetResult401;
        /* Response get status 404 do not describe any schema nor MIME */
        class GetResult404 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 404;
            }
        }
        Status.GetResult404 = GetResult404;
        /* Response get status 500 do not describe any schema nor MIME */
        class GetResult500 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 500;
            }
        }
        Status.GetResult500 = GetResult500;
        /* Response get status 505 do not describe any schema nor MIME */
        class GetResult505 extends BaseControllerResponse {
            constructor(...args) {
                super(...args);
                this.status = 505;
            }
        }
        Status.GetResult505 = GetResult505;
        /**
        * /status abstract handler.
        */
        class AbstractHandler extends BaseController {
            constructor(...args) {
                super(...args);
                this.baseUri = "/status";
                this.baseUriParameters = {};
                this.methods = {
                    "get": {
                        "body": false,
                        "queryString": {
                            "desiredStatus": {
                                "displayName": "desiredStatus",
                                "type": "integer",
                                "required": true,
                                "description": "",
                                "name": "desiredStatus"
                            }
                        },
                        "headers": null,
                        "securedBy": []
                    }
                };
                this.uriParameters = {};
            }
        }
        Status.AbstractHandler = AbstractHandler;
    })(Status = DemoApiV1.Status || (DemoApiV1.Status = {}));
})(DemoApiV1 = exports.DemoApiV1 || (exports.DemoApiV1 = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0ZBQWdGOzs7Ozs7Ozs7O0FBWWhGLElBQUksWUFBWSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUM1QyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFJeEMsV0FBVztBQUNYLElBQWlCLFNBQVMsQ0F3WHpCO0FBeFhELFdBQWlCLFNBQVMsRUFBQyxDQUFDO0lBSTFCLElBQUksU0FBUyxHQUFHLFlBQVksRUFBRSxDQUFDO0lBRS9CLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBRWhEO1FBR0UsWUFBbUIsSUFBUTtZQUFSLFNBQUksR0FBSixJQUFJLENBQUk7WUFGM0IsV0FBTSxHQUFXLEdBQUcsQ0FBQztRQUVTLENBQUM7SUFDakMsQ0FBQztJQUpZLGdDQUFzQix5QkFJbEMsQ0FBQTtJQUVEO1FBQ0UsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRmUsdUJBQWEsZ0JBRTVCLENBQUE7SUFFRCxvQkFBMkIsY0FBK0I7UUFDeEQsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFhLENBQUM7SUFDN0YsQ0FBQztJQUZlLG9CQUFVLGFBRXpCLENBQUE7SUFFRCxJQUFpQixtQkFBbUIsQ0FPbkM7SUFQRCxXQUFpQixtQkFBbUIsRUFBQyxDQUFDO1FBQ3ZCLG9DQUFnQixHQUFHLEVBQUUsQ0FBQztRQUVuQyx5QkFBZ0MsR0FBb0IsRUFBRSxHQUFxQixFQUFFLElBQUk7WUFDL0UsSUFBSSxFQUFFLENBQUM7UUFDVCxDQUFDO1FBRmUsbUNBQWUsa0JBRTlCLENBQUE7SUFFSCxDQUFDLEVBUGdCLG1CQUFtQixHQUFuQiw2QkFBbUIsS0FBbkIsNkJBQW1CLFFBT25DO0lBRUQsSUFBVSwyQkFBMkIsQ0FFcEM7SUFGRCxXQUFVLDJCQUEyQixFQUFDLENBQUM7UUFDeEIsMkNBQWUsR0FBRyxDQUFDLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxJQUFJLEtBQUssbUJBQW1CLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDNUksQ0FBQyxFQUZTLDJCQUEyQixLQUEzQiwyQkFBMkIsUUFFcEM7SUFJRDs7T0FFRztJQUNILDJCQUEyQixJQUFJO1FBQzdCLE1BQU0sQ0FBQyxVQUFVLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtZQUM3QixjQUFjLENBQUM7Z0JBQ2IsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNsQixFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztvQkFBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3hCLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLFVBQVUsR0FBRztvQkFDekIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO3dCQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQzFCLElBQUksQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1osQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztJQUVEO1FBWUUsNkRBQTZEO1FBQzdELGNBQWMsQ0FBQyxZQUFhO1lBQzFCLEVBQUUsQ0FBQSxDQUFDLENBQUMsWUFBWSxDQUFDO2dCQUFDLFlBQVksR0FBRyxTQUFTLENBQUM7WUFDM0MsR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2hDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FDaEIsSUFBSSxDQUFDLE9BQU8sRUFDWixJQUFJLENBQUMsaUJBQWlCLEVBQ3RCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQ3JDLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQztRQUVPLHlCQUF5QixDQUFDLE1BQTBFO1lBQzFHLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztZQUNyQixHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQSxDQUFDO2dCQUNuQixJQUFJLFNBQVMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUM7Z0JBQzdJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLFNBQVMsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLFNBQVMsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFBLENBQUM7b0JBQzdHLE1BQU0sSUFBSSxLQUFLLENBQUMsaUNBQWlDLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN0RSxDQUFDO2dCQUVELEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksUUFBUSxJQUFJLFNBQVMsQ0FBQyxJQUFJLElBQUksU0FBUyxDQUFDLENBQUEsQ0FBQztvQkFDN0QsRUFBRSxDQUFDLENBQUMsT0FBTyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksV0FBVyxJQUFJLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFBLENBQUM7d0JBQzdFLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksUUFBUSxDQUFDOzRCQUM3QixXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUM5QyxJQUFJOzRCQUNGLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBRTVDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUM7NEJBQ3pCLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFDO2dDQUN0QixNQUFNLElBQUksS0FBSyxDQUFDLGlDQUFpQyxHQUFHLFNBQVMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQ2pKLENBQUM7NEJBQUMsSUFBSSxDQUFDLENBQUM7Z0NBQ04sV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDOzRCQUM3QyxDQUFDO3dCQUNILENBQUM7b0JBQ0gsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztZQUNELE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDckIsQ0FBQztRQUVPLG9CQUFvQixDQUFDLE9BQXlDO1lBQ3BFLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztZQUNiLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFBLENBQUM7Z0JBQ3BCLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDeEIsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQztZQUMxRSxDQUFDO1lBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQztRQUNiLENBQUM7UUFFTyxpQkFBaUIsQ0FBQyxJQUFZLEVBQUUsTUFBTTtZQUM1QyxJQUFJLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtnQkFDOUIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFFbkMsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO2dCQUVkLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUNoQixFQUFFLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQzt3QkFDckMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO29CQUM5QixDQUFDO29CQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNOLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO29CQUNwQyxDQUFDO29CQUVELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlDLENBQUM7Z0JBRUQsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFBLENBQUM7b0JBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUNoRSxDQUFDO2dCQUVELEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQSxDQUFDO29CQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDdkQsQ0FBQztnQkFFRCxJQUFJLENBQUM7b0JBQ0gsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBK0I7d0JBQ2hFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksc0JBQXNCLENBQUMsQ0FBQyxDQUFDOzRCQUM3QyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQzs0QkFFckIsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0NBQ1gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDOzRCQUNsQyxDQUFDOzRCQUVELEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksa0JBQWtCLENBQUMsQ0FBQyxDQUFDO2dDQUNqQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQzs0QkFDbkIsQ0FBQzs0QkFBQyxJQUFJLENBQUMsQ0FBQztnQ0FDTixHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQzs0QkFDbkIsQ0FBQzs0QkFFRCxNQUFNLENBQUM7d0JBQ1QsQ0FBQzt3QkFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUNiLElBQUksRUFBRSxDQUFDOzRCQUNQLE1BQU0sQ0FBQzt3QkFDVCxDQUFDO3dCQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksS0FBSyxDQUFDOzRCQUN6QixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ1YsSUFBSTs0QkFDRixJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztvQkFDeEYsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUVqQixDQUFFO2dCQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ1gsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNWLENBQUM7WUFDSCxDQUFDLENBQUM7WUFFRixFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUM7Z0JBQzFCLE1BQU0sQ0FBQyxpQkFBaUIsQ0FDdEIsTUFBTTtxQkFDSCxTQUFTO3FCQUNQLEdBQUcsQ0FBQyxjQUFjLElBQUksMkJBQTJCLENBQUMsY0FBYyxDQUFDLENBQUM7cUJBQ3BFLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FDdEIsQ0FBQztZQUNKLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixNQUFNLENBQUMsVUFBVSxDQUFDO1lBQ3BCLENBQUM7UUFHSCxDQUFDO1FBRUQsbUJBQW1CLENBQUMsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEdBQWM7WUFDN0UsSUFBSSxDQUFDLGNBQWMsR0FBRztnQkFDcEIsT0FBTyxFQUFFLEdBQUc7Z0JBQ1osUUFBUSxFQUFFLEdBQUc7Z0JBQ2IsT0FBTyxFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUM7YUFDekIsQ0FBQztZQUVGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM3RCxDQUFDO1FBRUQsaUJBQWlCLENBQUMsTUFBVztZQUMzQixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFBQyxNQUFNLENBQUM7WUFDcEIsR0FBRyxDQUFBLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUEsQ0FBQztnQkFDdkMsRUFBRSxDQUFBLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxDQUFBLENBQUM7b0JBQ2xCLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM1QyxDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBdEpZLHdCQUFjLGlCQXNKMUIsQ0FBQTtJQW9CRDs7O09BR0c7SUFDSCxJQUFpQixFQUFFLENBNkJsQjtJQTdCRCxXQUFpQixFQUFFLEVBQUMsQ0FBQztRQUluQiwyQkFBa0Msc0JBQXNCO1lBQXhEO2dCQUFrQyxlQUFpQztnQkFBRyxXQUFNLEdBQUcsR0FBRyxDQUFDO2dCQUFDLFNBQUksR0FBRyxrQkFBa0IsQ0FBQTtZQUFDLENBQUM7UUFBRCxDQUFDO1FBQWxHLGVBQVksZUFBc0YsQ0FBQTtRQUkvRzs7VUFFRTtRQUNGLDhCQUE4QyxjQUFjO1lBQTVEO2dCQUE4QyxlQUFjO2dCQUMxRCxZQUFPLEdBQUcsS0FBSyxDQUFDO2dCQUNoQixzQkFBaUIsR0FBRyxFQUFFLENBQUM7Z0JBQ3ZCLFlBQU8sR0FBRztvQkFDZCxLQUFLLEVBQUU7d0JBQ0wsTUFBTSxFQUFFLEtBQUs7d0JBQ2IsYUFBYSxFQUFFLElBQUk7d0JBQ25CLFNBQVMsRUFBRSxJQUFJO3dCQUNmLFdBQVcsRUFBRSxFQUFFO3FCQUNoQjtpQkFDRixDQUFDO2dCQUNJLGtCQUFhLEdBQUcsRUFFakIsQ0FBQTtZQUlELENBQUM7UUFBRCxDQUFDO1FBakJxQixrQkFBZSxrQkFpQnBDLENBQUE7SUFDSCxDQUFDLEVBN0JnQixFQUFFLEdBQUYsWUFBRSxLQUFGLFlBQUUsUUE2QmxCO0lBS0Q7OztPQUdHO0lBQ0gsSUFBaUIsUUFBUSxDQStDeEI7SUEvQ0QsV0FBaUIsUUFBUSxFQUFDLENBQUM7UUFJekIsMkJBQWtDLHNCQUFzQjtZQUF4RDtnQkFBa0MsZUFBd0M7Z0JBQUcsV0FBTSxHQUFHLEdBQUcsQ0FBQztnQkFBQyxTQUFJLEdBQUcsa0JBQWtCLENBQUE7WUFBQyxDQUFDO1FBQUQsQ0FBQztRQUF6RyxxQkFBWSxlQUE2RixDQUFBO1FBSXRIOztVQUVFO1FBQ0YsOEJBQThDLGNBQWM7WUFBNUQ7Z0JBQThDLGVBQWM7Z0JBQzFELFlBQU8sR0FBRyxpQkFBaUIsQ0FBQztnQkFDNUIsc0JBQWlCLEdBQUc7b0JBQ3hCLFFBQVEsRUFBRTt3QkFDUixhQUFhLEVBQUUsUUFBUTt3QkFDdkIsTUFBTSxFQUFFLFFBQVE7d0JBQ2hCLFVBQVUsRUFBRSxJQUFJO3dCQUNoQixhQUFhLEVBQUUsRUFBRTtxQkFDbEI7aUJBQ0YsQ0FBQztnQkFDSSxZQUFPLEdBQUc7b0JBQ2QsS0FBSyxFQUFFO3dCQUNMLE1BQU0sRUFBRSxLQUFLO3dCQUNiLGFBQWEsRUFBRTs0QkFDYixRQUFRLEVBQUU7Z0NBQ1IsYUFBYSxFQUFFLFFBQVE7Z0NBQ3ZCLE1BQU0sRUFBRSxRQUFRO2dDQUNoQixhQUFhLEVBQUUsRUFBRTtnQ0FDakIsTUFBTSxFQUFFLFFBQVE7NkJBQ2pCO3lCQUNGO3dCQUNELFNBQVMsRUFBRSxJQUFJO3dCQUNmLFdBQVcsRUFBRSxFQUFFO3FCQUNoQjtpQkFDRixDQUFDO2dCQUNJLGtCQUFhLEdBQUc7b0JBQ2hCLE1BQU0sRUFBRSxLQUFJLENBQUMsQ0FBQyxDQUFXO2lCQUMxQixDQUFBO1lBUUQsQ0FBQztRQUFELENBQUM7UUFuQ3FCLHdCQUFlLGtCQW1DcEMsQ0FBQTtJQUNILENBQUMsRUEvQ2dCLFFBQVEsR0FBUixrQkFBUSxLQUFSLGtCQUFRLFFBK0N4QjtJQUlEOzs7T0FHRztJQUNILElBQWlCLE1BQU0sQ0FvRHRCO0lBcERELFdBQWlCLE1BQU0sRUFBQyxDQUFDO1FBSXZCLGlFQUFpRTtRQUNqRSwyQkFBa0Msc0JBQXNCO1lBQXhEO2dCQUFrQyxlQUEyQjtnQkFBRyxXQUFNLEdBQUcsR0FBRyxDQUFDO1lBQUMsQ0FBQztRQUFELENBQUM7UUFBbEUsbUJBQVksZUFBc0QsQ0FBQTtRQUMvRSxpRUFBaUU7UUFDakUsMkJBQWtDLHNCQUFzQjtZQUF4RDtnQkFBa0MsZUFBMkI7Z0JBQUcsV0FBTSxHQUFHLEdBQUcsQ0FBQztZQUFDLENBQUM7UUFBRCxDQUFDO1FBQWxFLG1CQUFZLGVBQXNELENBQUE7UUFDL0UsaUVBQWlFO1FBQ2pFLDJCQUFrQyxzQkFBc0I7WUFBeEQ7Z0JBQWtDLGVBQTJCO2dCQUFHLFdBQU0sR0FBRyxHQUFHLENBQUM7WUFBQyxDQUFDO1FBQUQsQ0FBQztRQUFsRSxtQkFBWSxlQUFzRCxDQUFBO1FBQy9FLGlFQUFpRTtRQUNqRSwyQkFBa0Msc0JBQXNCO1lBQXhEO2dCQUFrQyxlQUEyQjtnQkFBRyxXQUFNLEdBQUcsR0FBRyxDQUFDO1lBQUMsQ0FBQztRQUFELENBQUM7UUFBbEUsbUJBQVksZUFBc0QsQ0FBQTtRQUMvRSxpRUFBaUU7UUFDakUsMkJBQWtDLHNCQUFzQjtZQUF4RDtnQkFBa0MsZUFBMkI7Z0JBQUcsV0FBTSxHQUFHLEdBQUcsQ0FBQztZQUFDLENBQUM7UUFBRCxDQUFDO1FBQWxFLG1CQUFZLGVBQXNELENBQUE7UUFDL0UsaUVBQWlFO1FBQ2pFLDJCQUFrQyxzQkFBc0I7WUFBeEQ7Z0JBQWtDLGVBQTJCO2dCQUFHLFdBQU0sR0FBRyxHQUFHLENBQUM7WUFBQyxDQUFDO1FBQUQsQ0FBQztRQUFsRSxtQkFBWSxlQUFzRCxDQUFBO1FBSS9FOztVQUVFO1FBQ0YsOEJBQThDLGNBQWM7WUFBNUQ7Z0JBQThDLGVBQWM7Z0JBQzFELFlBQU8sR0FBRyxTQUFTLENBQUM7Z0JBQ3BCLHNCQUFpQixHQUFHLEVBQUUsQ0FBQztnQkFDdkIsWUFBTyxHQUFHO29CQUNkLEtBQUssRUFBRTt3QkFDTCxNQUFNLEVBQUUsS0FBSzt3QkFDYixhQUFhLEVBQUU7NEJBQ2IsZUFBZSxFQUFFO2dDQUNmLGFBQWEsRUFBRSxlQUFlO2dDQUM5QixNQUFNLEVBQUUsU0FBUztnQ0FDakIsVUFBVSxFQUFFLElBQUk7Z0NBQ2hCLGFBQWEsRUFBRSxFQUFFO2dDQUNqQixNQUFNLEVBQUUsZUFBZTs2QkFDeEI7eUJBQ0Y7d0JBQ0QsU0FBUyxFQUFFLElBQUk7d0JBQ2YsV0FBVyxFQUFFLEVBQUU7cUJBQ2hCO2lCQUNGLENBQUM7Z0JBQ0ksa0JBQWEsR0FBRyxFQUVqQixDQUFBO1lBUUQsQ0FBQztRQUFELENBQUM7UUE3QnFCLHNCQUFlLGtCQTZCcEMsQ0FBQTtJQUNILENBQUMsRUFwRGdCLE1BQU0sR0FBTixnQkFBTSxLQUFOLGdCQUFNLFFBb0R0QjtBQUVILENBQUMsRUF4WGdCLFNBQVMsR0FBVCxpQkFBUyxLQUFULGlCQUFTLFFBd1h6QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIFRISVMgSVMgQU4gQVVUT0dFTkVSQVRFRCBGSUxFLCBBTlkgQ0hBTkdFUyBXSUxMIEJFIExPU1QuIERPIE5PIEVESVQgVEhJUyBGSUxFXG5cblxuXG4vKiBUT0RPOlxuaW5jbHVkZSBjcmVhdGlvbiBkYXRlIGFuZCBlZGl0aW9uIHdhcm5pbmdzXG5pbmNsdWRlIHZlcnNpb24gb2YgZ2VuZXJhdG9yXG5mb3JtYXQgY29kZVxuaGFuZGxlIHJlcXVlc3QgJiByZXNwb25zZSBoZWFkZXJzXG4qL1xuXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xudmFyIG9zcHJleVJvdXRlciA9IHJlcXVpcmUoJ29zcHJleS1yb3V0ZXInKTtcbnZhciBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcblxuZGVjbGFyZSBpbnRlcmZhY2UgSUNvbnRleHQgeyAvKiB5b3UgbXVzdCBkZWNsYXJlIGEgZ2xvYmFsIGludGVyZmFjZSBmb3IgY29udGV4dCAqLyB9XG5cbi8vLyBEZW1vQXBpXG5leHBvcnQgbmFtZXNwYWNlIERlbW9BcGlWMSB7XG4gXG4gIGV4cG9ydCBpbnRlcmZhY2UgRGljdGlvbmFyeTxUPiB7IFtrZXk6IHN0cmluZ10gOiBUOyB9XG5cbiAgdmFyIHRoZVJvdXRlciA9IG9zcHJleVJvdXRlcigpO1xuICBcbiAgY29uc3QgY29udGV4dFN5bWJvbCA9IFN5bWJvbCgncmVxdWVzdC1jb250ZXh0Jyk7XG4gIFxuICBleHBvcnQgY2xhc3MgQmFzZUNvbnRyb2xsZXJSZXNwb25zZTxUPiB7XG4gICAgc3RhdHVzOiBudW1iZXIgPSAyMDA7XG4gICAgbWltZTogc3RyaW5nO1xuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBkYXRhPzogVCl7IH1cbiAgfVxuXG4gIGV4cG9ydCBmdW5jdGlvbiBnZXRNaWRkbGV3YXJlKCkge1xuICAgIHJldHVybiB0aGVSb3V0ZXI7XG4gIH1cbiAgXG4gIGV4cG9ydCBmdW5jdGlvbiBnZXRDb250ZXh0KGV4cHJlc3NSZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QpOiBJQ29udGV4dCB7XG4gICAgcmV0dXJuIChleHByZXNzUmVxdWVzdFtjb250ZXh0U3ltYm9sXSA9IChleHByZXNzUmVxdWVzdFtjb250ZXh0U3ltYm9sXSB8fCB7fSkpIGFzIElDb250ZXh0O1xuICB9XG5cbiAgZXhwb3J0IG5hbWVzcGFjZSBTZWN1cml0eU1pZGRsZXdhcmVzIHtcbiAgICBleHBvcnQgY29uc3Qgc2VjdXJpdHlTZXR0aW5ncyA9IHt9O1xuICAgIFxuICAgIGV4cG9ydCBmdW5jdGlvbiBub19hdXRoZW50aWNhdGUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSwgbmV4dCl7XG4gICAgICBuZXh0KCk7XG4gICAgfSAgXG4gICAgXG4gIH1cbiAgXG4gIG5hbWVzcGFjZSBTZWN1cml0eU1pZGRsZXdhcmVzSW52b2tlcnMge1xuICAgIGV4cG9ydCBjb25zdCBub19hdXRoZW50aWNhdGUgPSAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSwgbmV4dCkgPT4gU2VjdXJpdHlNaWRkbGV3YXJlcy5ub19hdXRoZW50aWNhdGUocmVxLCByZXMsIG5leHQpO1xuICB9XG4gIFxuICBcbiAgXG4gIC8qKlxuICAgKiBAcGFyYW0ge0FycmF5fSBsaXN0IG9mIG1pZGRsZXdhcmUgdG8gY29tYmluZVxuICAgKi9cbiAgZnVuY3Rpb24gY29uY2F0TWlkZGxld2FyZXMobGlzdCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcbiAgICAgIGZ1bmN0aW9uIGl0ZXIoaSkge1xuICAgICAgICB2YXIgbWlkID0gbGlzdFtpXTtcbiAgICAgICAgaWYgKCFtaWQpIHJldHVybiBuZXh0KCk7XG4gICAgICAgIG1pZChyZXEsIHJlcywgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGlmIChlcnIpIHJldHVybiBuZXh0KGVycik7XG4gICAgICAgICAgaXRlcihpKzEpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaXRlcigwKTtcbiAgICB9XG4gIH1cbiAgXG4gIGV4cG9ydCBjbGFzcyBCYXNlQ29udHJvbGxlciB7XG4gICAgYmFzZVVyaTogc3RyaW5nO1xuICAgIGJhc2VVcmlQYXJhbWV0ZXJzOiBhbnk7XG4gICAgbWV0aG9kczogYW55O1xuICAgIHVyaVBhcmFtZXRlcnM6IGFueTtcbiAgICBcbiAgICBjdXJyZW50Q29udGV4dDoge1xuICAgICAgcmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LFxuICAgICAgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UsXG4gICAgICBjb250ZXh0OiBJQ29udGV4dFxuICAgIH07XG5cbiAgICAvKiogUmVnaXN0ZXIgdGhpcyByZXNvdXJjZSBpbiB0aGUgc3BlY2lmaWVkIG9zcHJleS1yb3V0ZXIuICovXG4gICAgcmVnaXN0ZXJSb3V0ZXIob3NwcmV5Um91dGVyPykge1xuICAgICAgaWYoIW9zcHJleVJvdXRlcikgb3NwcmV5Um91dGVyID0gdGhlUm91dGVyO1xuICAgICAgZm9yIChsZXQgdmVyYiBpbiB0aGlzLm1ldGhvZHMpIHtcbiAgICAgICAgbGV0IG1ldGhvZCA9IHRoaXMubWV0aG9kc1t2ZXJiXTtcbiAgICAgICAgb3NwcmV5Um91dGVyW3ZlcmJdKFxuICAgICAgICAgIHRoaXMuYmFzZVVyaSwgXG4gICAgICAgICAgdGhpcy5iYXNlVXJpUGFyYW1ldGVycywgXG4gICAgICAgICAgdGhpcy5nZXRSZXF1ZXN0SGFuZGxlcih2ZXJiLCBtZXRob2QpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgZ2VuZXJhdGVRdWVyeVN0cmluZ1BhcmFtcyhwYXJhbXM6IHsgbmFtZTogc3RyaW5nOyBkZWZhdWx0OiBhbnk7IHR5cGU6IHN0cmluZzsgcmVxdWlyZWQ6IGJvb2xlYW47IH1bXSl7XG4gICAgICB2YXIgcXVlcnlTdHJpbmcgPSB7fTtcbiAgICAgIGZvcihsZXQgaSBpbiBwYXJhbXMpe1xuICAgICAgICBsZXQgcGFyYW1ldGVyID0gcGFyYW1zW2ldO1xuICAgICAgICBxdWVyeVN0cmluZ1tpXSA9IHBhcmFtZXRlci5uYW1lIGluIHRoaXMuY3VycmVudENvbnRleHQucmVxdWVzdC5xdWVyeSA/IHRoaXMuY3VycmVudENvbnRleHQucmVxdWVzdC5xdWVyeVtwYXJhbWV0ZXIubmFtZV0gOiBwYXJhbWV0ZXIuZGVmYXVsdDtcbiAgICAgICAgaWYgKCEocGFyYW1ldGVyLm5hbWUgaW4gdGhpcy5jdXJyZW50Q29udGV4dC5yZXF1ZXN0LnF1ZXJ5KSAmJiBwYXJhbWV0ZXIucmVxdWlyZWQgJiYgISgnZGVmYXVsdCcgaW4gcGFyYW1ldGVyKSl7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBxdWVyeSBzdHJpbmcgcGFyYW1ldGVyIFwiICsgcGFyYW1ldGVyLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAocGFyYW1ldGVyLnR5cGUgPT0gXCJudW1iZXJcIiB8fCBwYXJhbWV0ZXIudHlwZSA9PSBcImludGVnZXJcIil7XG4gICAgICAgICAgaWYgKHR5cGVvZiBxdWVyeVN0cmluZ1tpXSAhPSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBxdWVyeVN0cmluZ1tpXSAhPSBcIm51bWJlclwiKXtcbiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXIudHlwZSA9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICBxdWVyeVN0cmluZ1tpXSA9IHBhcnNlRmxvYXQocXVlcnlTdHJpbmdbaV0pO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICBxdWVyeVN0cmluZ1tpXSA9IHBhcnNlSW50KHF1ZXJ5U3RyaW5nW2ldKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoaXNOYU4ocXVlcnlTdHJpbmdbaV0pKXtcbiAgICAgICAgICAgICAgaWYgKHBhcmFtZXRlci5yZXF1aXJlZCl7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBxdWVyeSBzdHJpbmcgcGFyYW1ldGVyIFwiICsgcGFyYW1ldGVyLm5hbWUgKyBcIjogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmN1cnJlbnRDb250ZXh0LnJlcXVlc3QucXVlcnlbcGFyYW1ldGVyLm5hbWVdKSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcXVlcnlTdHJpbmdbaV0gPSBwYXJhbWV0ZXIuZGVmYXVsdCB8fCBudWxsO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcXVlcnlTdHJpbmc7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgZ2VuZXJhdGVIZWFkZXJQYXJhbXMoaGVhZGVyczogeyBuYW1lOiBzdHJpbmc7IGRlZmF1bHQ6IGFueSB9W10pe1xuICAgICAgdmFyIHJldCA9IHt9O1xuICAgICAgZm9yKGxldCBpIGluIGhlYWRlcnMpe1xuICAgICAgICBsZXQgaGVhZGVyID0gaGVhZGVyc1tpXTtcbiAgICAgICAgcmV0W2ldID0gdGhpcy5jdXJyZW50Q29udGV4dC5yZXF1ZXN0LmdldChoZWFkZXIubmFtZSkgfHwgaGVhZGVyLmRlZmF1bHQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVxdWVzdEhhbmRsZXIobmFtZTogc3RyaW5nLCBtZXRob2QpIHtcbiAgICAgIGxldCBtaWRkbGV3YXJlID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0VXBDdXJyZW50Q29udGV4dChyZXEsIHJlcyk7XG4gICAgICAgICAgXG4gICAgICAgIGxldCBhcmdzID0gW107XG4gICAgICAgICAgXG4gICAgICAgIGlmIChtZXRob2QuYm9keSkge1xuICAgICAgICAgIGlmICh0eXBlb2YgbWV0aG9kLmJvZHkgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICBtZXRob2QuYm9keShyZXEsIHJlcywgbmV4dCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJvZHlQYXJzZXIuanNvbigpKHJlcSwgcmVzLCBuZXh0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgYXJncy5wdXNoKHRoaXMuY3VycmVudENvbnRleHQucmVxdWVzdC5ib2R5KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYobWV0aG9kLnF1ZXJ5U3RyaW5nKXtcbiAgICAgICAgICBhcmdzLnB1c2godGhpcy5nZW5lcmF0ZVF1ZXJ5U3RyaW5nUGFyYW1zKG1ldGhvZC5xdWVyeVN0cmluZykpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZihtZXRob2QuaGVhZGVycyl7XG4gICAgICAgICAgYXJncy5wdXNoKHRoaXMuZ2VuZXJhdGVIZWFkZXJQYXJhbXMobWV0aG9kLmhlYWRlcnMpKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzW25hbWVdLmFwcGx5KHRoaXMsIGFyZ3MpLnRoZW4oKHIgOiBCYXNlQ29udHJvbGxlclJlc3BvbnNlPGFueT4pID0+IHtcbiAgICAgICAgICAgIGlmIChyICYmIHIgaW5zdGFuY2VvZiBCYXNlQ29udHJvbGxlclJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMoci5zdGF0dXMpO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgaWYgKHIubWltZSkge1xuICAgICAgICAgICAgICAgIHJlcy5zZXQoJ0NvbnRlbnQtVHlwZScsIHIubWltZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGlmIChyLm1pbWUgPT0gJ2FwcGxpY2F0aW9uL2pzb24nKSB7XG4gICAgICAgICAgICAgICAgcmVzLmpzb24oci5kYXRhKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXMuc2VuZChyLmRhdGEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGVsc2UgaWYoIXIpIHtcbiAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihyICYmIHIgaW5zdGFuY2VvZiBFcnJvcilcbiAgICAgICAgICAgICAgbmV4dChyKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgbmV4dChuZXcgRXJyb3IoJ1Vua25vd24gbWV0aG9kIHJlc3VsdCAnICsgbmFtZS50b1VwcGVyQ2FzZSgpICsgJyAnICsgdGhpcy5iYXNlVXJpKSk7XG4gICAgICAgICAgfSkuY2F0Y2gobmV4dCk7XG4gICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBuZXh0KGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICBpZihtZXRob2Quc2VjdXJlZEJ5Lmxlbmd0aCl7XG4gICAgICAgIHJldHVybiBjb25jYXRNaWRkbGV3YXJlcyhcbiAgICAgICAgICBtZXRob2RcbiAgICAgICAgICAgIC5zZWN1cmVkQnlcbiAgICAgICAgICAgICAgLm1hcChzZWN1cml0eVNjaGVtYSA9PiBTZWN1cml0eU1pZGRsZXdhcmVzSW52b2tlcnNbc2VjdXJpdHlTY2hlbWFdKVxuICAgICAgICAgICAgLmNvbmNhdChtaWRkbGV3YXJlKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG1pZGRsZXdhcmU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIFxuICAgIH1cbiAgICBcbiAgICBzZXRVcEN1cnJlbnRDb250ZXh0KHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIGN0eD86IElDb250ZXh0KXtcbiAgICAgIHRoaXMuY3VycmVudENvbnRleHQgPSB7XG4gICAgICAgIHJlcXVlc3Q6IHJlcSxcbiAgICAgICAgcmVzcG9uc2U6IHJlcyxcbiAgICAgICAgY29udGV4dDogZ2V0Q29udGV4dChyZXEpXG4gICAgICB9O1xuICAgICAgXG4gICAgICB0aGlzLmZpbGxVcmlQYXJhbWV0ZXJzKHRoaXMuY3VycmVudENvbnRleHQucmVxdWVzdC5wYXJhbXMpO1xuICAgIH1cbiAgICBcbiAgICBmaWxsVXJpUGFyYW1ldGVycyhwYXJhbXM6IGFueSl7XG4gICAgICBpZiAoIXBhcmFtcykgcmV0dXJuO1xuICAgICAgZm9yKHZhciBwYXJhbSBpbiB0aGlzLmJhc2VVcmlQYXJhbWV0ZXJzKXtcbiAgICAgICAgaWYocGFyYW0gaW4gcGFyYW1zKXtcbiAgICAgICAgICB0aGlzLnVyaVBhcmFtZXRlcnNbcGFyYW1dID0gcGFyYW1zW3BhcmFtXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbmV4cG9ydCBpbnRlcmZhY2UgSUdldE1lMjAwIHtcbiAgbmFtZTogc3RyaW5nO1xuICBjb21wYW55Pzogc3RyaW5nO1xuICBbazogc3RyaW5nXTogYW55O1xufWV4cG9ydCBpbnRlcmZhY2UgSUdldFVzZXJCeUlkMjAwIHtcbiAgbmFtZT86IHN0cmluZztcbiAgY29tcGFueT86IHN0cmluZztcbiAgW2s6IHN0cmluZ106IGFueTtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgSUdldFVzZXJCeUlkMjAwMCB7XG4gIGZpbHRlcj86IHN0cmluZztcbiAgcmVzdWx0cz86IElHZXRVc2VyQnlJZDIwMFtdO1xuICBbazogc3RyaW5nXTogYW55O1xufVxuXG4gIFxuICBcblxuICAvKiogXG4gICAqIC9tZVxuICAgKiBcbiAgICovXG4gIGV4cG9ydCBuYW1lc3BhY2UgTWUge1xuICAgIFxuXG5cbiAgICBleHBvcnQgY2xhc3MgR2V0UmVzdWx0MjAwIGV4dGVuZHMgQmFzZUNvbnRyb2xsZXJSZXNwb25zZTxJR2V0TWUyMDA+IHsgc3RhdHVzID0gMjAwOyBtaW1lID0gXCJhcHBsaWNhdGlvbi9qc29uXCIgfVxuICAgIFxuICAgIGV4cG9ydCB0eXBlIEdldFJlc3VsdHMgPSBHZXRSZXN1bHQyMDA7XG5cbiAgICAvKiogXG4gICAgKiAvbWUgYWJzdHJhY3QgaGFuZGxlci4gXG4gICAgKi9cbiAgICBleHBvcnQgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RIYW5kbGVyIGV4dGVuZHMgQmFzZUNvbnRyb2xsZXIge1xuICAgICAgYmFzZVVyaSA9IFwiL21lXCI7XG4gICAgICBiYXNlVXJpUGFyYW1ldGVycyA9IHt9O1xuICAgICAgbWV0aG9kcyA9IHtcbiAgXCJnZXRcIjoge1xuICAgIFwiYm9keVwiOiBmYWxzZSxcbiAgICBcInF1ZXJ5U3RyaW5nXCI6IG51bGwsXG4gICAgXCJoZWFkZXJzXCI6IG51bGwsXG4gICAgXCJzZWN1cmVkQnlcIjogW11cbiAgfVxufTtcbiAgICAgIHVyaVBhcmFtZXRlcnMgPSB7XG4gICAgICBcbiAgICB9XG5cbiAgICAgIC8qKiBnZXQgbWV0aG9kICovXG4gICAgICBhYnN0cmFjdCBhc3luYyBnZXQoKTogUHJvbWlzZTxHZXRSZXN1bHRzPjtcbiAgICB9XG4gIH1cbiAgXG4gIFxuICBcblxuICAvKiogXG4gICAqIC91c2Vycy97dXNlcklkfVxuICAgKiBcbiAgICovXG4gIGV4cG9ydCBuYW1lc3BhY2UgVXNlckJ5SWQge1xuICAgIFxuXG5cbiAgICBleHBvcnQgY2xhc3MgR2V0UmVzdWx0MjAwIGV4dGVuZHMgQmFzZUNvbnRyb2xsZXJSZXNwb25zZTxJR2V0VXNlckJ5SWQyMDAwPiB7IHN0YXR1cyA9IDIwMDsgbWltZSA9IFwiYXBwbGljYXRpb24vanNvblwiIH1cbiAgICBcbiAgICBleHBvcnQgdHlwZSBHZXRSZXN1bHRzID0gR2V0UmVzdWx0MjAwO1xuXG4gICAgLyoqIFxuICAgICogL3VzZXJzL3t1c2VySWR9IGFic3RyYWN0IGhhbmRsZXIuIFxuICAgICovXG4gICAgZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0SGFuZGxlciBleHRlbmRzIEJhc2VDb250cm9sbGVyIHtcbiAgICAgIGJhc2VVcmkgPSBcIi91c2Vycy97dXNlcklkfVwiO1xuICAgICAgYmFzZVVyaVBhcmFtZXRlcnMgPSB7XG4gIFwidXNlcklkXCI6IHtcbiAgICBcImRpc3BsYXlOYW1lXCI6IFwidXNlcklkXCIsXG4gICAgXCJ0eXBlXCI6IFwic3RyaW5nXCIsXG4gICAgXCJyZXF1aXJlZFwiOiB0cnVlLFxuICAgIFwiZGVzY3JpcHRpb25cIjogXCJcIlxuICB9XG59O1xuICAgICAgbWV0aG9kcyA9IHtcbiAgXCJnZXRcIjoge1xuICAgIFwiYm9keVwiOiBmYWxzZSxcbiAgICBcInF1ZXJ5U3RyaW5nXCI6IHtcbiAgICAgIFwiZmlsdGVyXCI6IHtcbiAgICAgICAgXCJkaXNwbGF5TmFtZVwiOiBcImZpbHRlclwiLFxuICAgICAgICBcInR5cGVcIjogXCJzdHJpbmdcIixcbiAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIlwiLFxuICAgICAgICBcIm5hbWVcIjogXCJmaWx0ZXJcIlxuICAgICAgfVxuICAgIH0sXG4gICAgXCJoZWFkZXJzXCI6IG51bGwsXG4gICAgXCJzZWN1cmVkQnlcIjogW11cbiAgfVxufTtcbiAgICAgIHVyaVBhcmFtZXRlcnMgPSB7XG4gICAgICB1c2VySWQ6IHZvaWQoMCkgYXMgc3RyaW5nXG4gICAgfVxuXG4gICAgICAvKiogZ2V0IG1ldGhvZCAqL1xuICAgICAgYWJzdHJhY3QgYXN5bmMgZ2V0KFxuICAgIHF1ZXJ5U3RyaW5nOiB7XG4gICAgICBmaWx0ZXI/OiBzdHJpbmc7XG4gICAgfVxuICApOiBQcm9taXNlPEdldFJlc3VsdHM+O1xuICAgIH1cbiAgfVxuICBcbiAgXG5cbiAgLyoqIFxuICAgKiAvc3RhdHVzXG4gICAqIFxuICAgKi9cbiAgZXhwb3J0IG5hbWVzcGFjZSBTdGF0dXMge1xuICAgIFxuXG5cbiAgICAvKiBSZXNwb25zZSBnZXQgc3RhdHVzIDIwMCBkbyBub3QgZGVzY3JpYmUgYW55IHNjaGVtYSBub3IgTUlNRSAqL1xuICAgIGV4cG9ydCBjbGFzcyBHZXRSZXN1bHQyMDAgZXh0ZW5kcyBCYXNlQ29udHJvbGxlclJlc3BvbnNlPGFueT4geyBzdGF0dXMgPSAyMDA7IH1cbiAgICAvKiBSZXNwb25zZSBnZXQgc3RhdHVzIDIwMiBkbyBub3QgZGVzY3JpYmUgYW55IHNjaGVtYSBub3IgTUlNRSAqL1xuICAgIGV4cG9ydCBjbGFzcyBHZXRSZXN1bHQyMDIgZXh0ZW5kcyBCYXNlQ29udHJvbGxlclJlc3BvbnNlPGFueT4geyBzdGF0dXMgPSAyMDI7IH1cbiAgICAvKiBSZXNwb25zZSBnZXQgc3RhdHVzIDQwMSBkbyBub3QgZGVzY3JpYmUgYW55IHNjaGVtYSBub3IgTUlNRSAqL1xuICAgIGV4cG9ydCBjbGFzcyBHZXRSZXN1bHQ0MDEgZXh0ZW5kcyBCYXNlQ29udHJvbGxlclJlc3BvbnNlPGFueT4geyBzdGF0dXMgPSA0MDE7IH1cbiAgICAvKiBSZXNwb25zZSBnZXQgc3RhdHVzIDQwNCBkbyBub3QgZGVzY3JpYmUgYW55IHNjaGVtYSBub3IgTUlNRSAqL1xuICAgIGV4cG9ydCBjbGFzcyBHZXRSZXN1bHQ0MDQgZXh0ZW5kcyBCYXNlQ29udHJvbGxlclJlc3BvbnNlPGFueT4geyBzdGF0dXMgPSA0MDQ7IH1cbiAgICAvKiBSZXNwb25zZSBnZXQgc3RhdHVzIDUwMCBkbyBub3QgZGVzY3JpYmUgYW55IHNjaGVtYSBub3IgTUlNRSAqL1xuICAgIGV4cG9ydCBjbGFzcyBHZXRSZXN1bHQ1MDAgZXh0ZW5kcyBCYXNlQ29udHJvbGxlclJlc3BvbnNlPGFueT4geyBzdGF0dXMgPSA1MDA7IH1cbiAgICAvKiBSZXNwb25zZSBnZXQgc3RhdHVzIDUwNSBkbyBub3QgZGVzY3JpYmUgYW55IHNjaGVtYSBub3IgTUlNRSAqL1xuICAgIGV4cG9ydCBjbGFzcyBHZXRSZXN1bHQ1MDUgZXh0ZW5kcyBCYXNlQ29udHJvbGxlclJlc3BvbnNlPGFueT4geyBzdGF0dXMgPSA1MDU7IH1cbiAgICBcbiAgICBleHBvcnQgdHlwZSBHZXRSZXN1bHRzID0gR2V0UmVzdWx0MjAwIHwgR2V0UmVzdWx0MjAyIHwgR2V0UmVzdWx0NDAxIHwgR2V0UmVzdWx0NDA0IHwgR2V0UmVzdWx0NTAwIHwgR2V0UmVzdWx0NTA1O1xuXG4gICAgLyoqIFxuICAgICogL3N0YXR1cyBhYnN0cmFjdCBoYW5kbGVyLiBcbiAgICAqL1xuICAgIGV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdEhhbmRsZXIgZXh0ZW5kcyBCYXNlQ29udHJvbGxlciB7XG4gICAgICBiYXNlVXJpID0gXCIvc3RhdHVzXCI7XG4gICAgICBiYXNlVXJpUGFyYW1ldGVycyA9IHt9O1xuICAgICAgbWV0aG9kcyA9IHtcbiAgXCJnZXRcIjoge1xuICAgIFwiYm9keVwiOiBmYWxzZSxcbiAgICBcInF1ZXJ5U3RyaW5nXCI6IHtcbiAgICAgIFwiZGVzaXJlZFN0YXR1c1wiOiB7XG4gICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJkZXNpcmVkU3RhdHVzXCIsXG4gICAgICAgIFwidHlwZVwiOiBcImludGVnZXJcIixcbiAgICAgICAgXCJyZXF1aXJlZFwiOiB0cnVlLFxuICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiXCIsXG4gICAgICAgIFwibmFtZVwiOiBcImRlc2lyZWRTdGF0dXNcIlxuICAgICAgfVxuICAgIH0sXG4gICAgXCJoZWFkZXJzXCI6IG51bGwsXG4gICAgXCJzZWN1cmVkQnlcIjogW11cbiAgfVxufTtcbiAgICAgIHVyaVBhcmFtZXRlcnMgPSB7XG4gICAgICBcbiAgICB9XG5cbiAgICAgIC8qKiBnZXQgbWV0aG9kICovXG4gICAgICBhYnN0cmFjdCBhc3luYyBnZXQoXG4gICAgcXVlcnlTdHJpbmc6IHtcbiAgICAgIGRlc2lyZWRTdGF0dXM6IG51bWJlcjtcbiAgICB9XG4gICk6IFByb21pc2U8R2V0UmVzdWx0cz47XG4gICAgfVxuICB9XG4gIFxufSJdfQ==